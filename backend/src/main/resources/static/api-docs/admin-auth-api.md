# 管理员认证接口文档

## 基本信息

- 基础路径: `/api/auth`
- 接口安全性: 除登录接口外，所有接口都需要携带有效的JWT令牌

## 1. 管理员登录

### 请求信息

- **接口URL**: `/api/auth/login`
- **请求方式**: POST
- **接口描述**: 管理员登录接口，验证管理员身份并返回访问令牌

### 请求参数

#### 请求头
```
Content-Type: application/json
```

#### 请求体
```json
{
    "username": "admin",     
    "password": "password",  
    "captcha": "1234"       
}
```

### 响应信息

#### 成功响应 (状态码: 200)
```json
{
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",  // JWT令牌
    "tokenType": "Bearer",                                // 令牌类型
    "expiresIn": 3600,                                   // 过期时间（秒）
    "adminInfo": {
        "adminId": 1,                                    // 管理员ID
        "username": "admin",                             // 用户名
        "lastLoginTime": "2024-03-25T12:00:00",         // 上次登录时间
        "lastLoginIp": "127.0.0.1"                      // 上次登录IP
    }
}
```

#### 错误响应
- 400: 请求参数错误
  ```json
  {
      "message": "用户名或密码错误"
  }
  ```
- 429: 请求过于频繁
  ```json
  {
      "message": "请求过于频繁，请稍后再试"
  }
  ```

## 2. 管理员登出

### 请求信息

- **接口URL**: `/api/auth/logout`
- **请求方式**: POST
- **接口描述**: 管理员登出接口，使当前令牌失效

### 请求参数

#### 请求头
```
Authorization: Bearer {token}
```

### 响应信息

#### 成功响应 (状态码: 200)
```json
// 无响应体
```

#### 错误响应
- 401: 未授权或令牌已失效
  ```json
  {
      "message": "未授权或令牌已失效"
  }
  ```

## 3. 获取用户统计信息

### 请求信息

- **接口URL**: `/api/auth/statistics/users`
- **请求方式**: GET
- **接口描述**: 获取平台用户统计信息，包括总用户数、新增用户数等

### 请求参数

#### 请求头
```
Authorization: Bearer {token}
```

### 响应信息

#### 成功响应 (状态码: 200)
```json
{
    "totalUsers": 1000,           // 总用户数
    "todayNewUsers": 10,          // 今日新增用户数
    "monthlyActiveUsers": 500,    // 本月活跃用户数
    "normalUsers": 900,           // 正常状态用户数
    "disabledUsers": 50,          // 禁用状态用户数
    "inactiveUsers": 50,          // 未激活用户数
    "statisticsTime": "2024-03-25T15:30:00"  // 统计时间
}
```

#### 错误响应
- 401: 未授权
  ```json
  {
      "message": "未授权或令牌已失效"
  }
  ```
- 403: 权限不足
  ```json
  {
      "message": "没有访问权限"
  }
  ```

### 性能说明

1. **缓存策略**
   - 使用 Redis 缓存统计结果，缓存时间 5 分钟
   - 支持分布式部署，多实例共享缓存
   - 异步更新缓存，不影响接口响应时间

2. **查询优化**
   - 使用数据库索引优化查询性能
   - 采用分组统计，减少数据库查询次数
   - 使用计数器表优化高频统计操作

3. **并发处理**
   - 使用分布式锁防止缓存击穿
   - 采用双重检查机制减少锁竞争
   - 支持高并发访问

### 使用建议

1. 建议在管理后台定时刷新，间隔不小于 1 分钟
2. 首次加载可能较慢，后续访问将使用缓存
3. 统计数据精确到分钟级别
4. 可以通过监控接口响应时间来评估系统性能

## 安全性说明

1. **令牌安全**
   - 使用 JWT (JSON Web Token) 进行身份验证
   - 令牌默认有效期为1小时
   - 令牌包含管理员ID和权限信息
   - 登出后令牌立即失效

2. **密码安全**
   - 密码传输使用 HTTPS 加密
   - 密码存储使用 BCrypt 加密
   - 密码不允许明文传输

3. **访问控制**
   - 使用基于角色的访问控制 (RBAC)
   - 每个请求都会验证令牌有效性
   - 敏感操作需要额外的权限验证

4. **防护措施**
   - 登录接口有频率限制，防止暴力破解
   - 验证码机制防止自动化攻击
   - 异常登录检测和IP记录

## 注意事项

1. 所有请求都应使用 HTTPS 协议
2. 令牌应妥善保管，不要在客户端明文存储
3. 登出后应清除客户端存储的令牌
4. 建议在每次应用启动时验证令牌有效性
5. 令牌过期前可以调用刷新令牌接口获取新令牌 